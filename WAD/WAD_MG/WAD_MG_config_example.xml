<?xml version="1.0" encoding="UTF-8"?>

<!--
    Configuratie voor WAD MG analyse module
-->

<WAD_MG_config>
    <!-- naam van de configuratie -->
    <name>Selenia</name>

    <!-- beschrijving -->
    <description>WAD MG configuratie voor VUmc Hologic Selenia</description>

    <!-- versie / datum -->
    <version>20120814</version>
        
    <!-- Logfile verbose options -->
    <logverbose>
	<!-- mode: 0 = quiet, 1 = to logfile, 2 = to screen, 3 = to log + screen -->
	<mode>1</mode>
	<!-- level: 1 = normal, 2 = output series search -->
	<level>1</level>
    </logverbose>

<!--
    Lijst van analyses
    De configuratie is per Matlab functie:
    - <name> naam van de Matlab functie (zie documentatie voor valide funties)
    - <match> series description: indien gelijk wordt de functie gestart
      <match field="SeriesDescription"> idem
      <match type="DCM4CHEE" field="SeriesDescription"> idem
      <match field="ImagesInSeries"> aantal beelden in de DICOM serie: indien gelijk wordt de functie gestart
      <match type="DICOM" field="SequenceName"> DICOM veld inhoud: indien gelijk wordt de functie gestart
      Valide "DCM4CHEE" velden (uit de DCM4CHEE database) zijn SeriesDescription en ImagesInSeries (aantal beelden in serie).
      NB: test op DICOM veld is trager dan "interne" velden.
    - optioneel: <params> configuratie parameters per funtie
    - optioneel: <limits> actielimieten per resultaat
-->

<!--
    <action>
	<name>test_dummy</name>
	<match>jajaja</match>
    </action>
-->

    <action>
	<!-- AEC -->
	<name>WAD_MG_AEC</name>
	<!-- series selectie -->
	<!-- SOP class ForPresentation -->
	<match type="DICOM" field="MediaStorageSOPClassUID">1.2.840.10008.5.1.4.1.1.1.2.1</match>
	<!-- AEC mode Auto Time -->
	<match type="DICOM" field="ExposureControlMode">AUTO_TIME</match>
	<!-- Molybdenum filter -->
	<match type="DICOM" field="FilterMaterial">MOLYBDENUM</match>
	<!-- parameters -->
	<params>
	    <!-- where to find the exposure index -->
	    <EI_field>RelativeXrayExposure</EI_field>
	</params>
	<limits>
	    <Exposure>
		<!-- 54 +/- 5% en 8% -->
		<acceptable>
		    <lower>51.30</lower>
		    <upper>56.70</upper>
		</acceptable>
		<critical>		
		    <lower>49.70</lower>
		    <upper>58.30</upper>
		</critical>
	    </Exposure>
	    <ExposureIndex>
		<!-- 413 +/- 5% en 8% -->
		<acceptable>
		    <lower>392.00</lower>
		    <upper>434.00</upper>
		</acceptable>
		<critical>		
		    <lower>380.00</lower>
		    <upper>446.00</upper>
		</critical>
	    </ExposureIndex>
	    <ExposureTime>
		<!-- 640.4, 20% en 30% -->
		<acceptable>
		    <lower>512.30</lower>
		    <upper>768.50</upper>
		</acceptable>
		<critical>		
		    <lower>448.30</lower>
		    <upper>832.50</upper>
		</critical>
	    </ExposureTime>
	    <OrganDose>
	        <!-- 0.01 +/- 50% en 60% -->
		<acceptable>
		    <lower>0.005</lower>
		    <upper>0.015</upper>
		</acceptable>
		<critical>		
		    <lower>0.004</lower>
		    <upper>0.016</upper>
		</critical>
	    </OrganDose>
	    <EntranceDose>
		<!-- 11.8 +/- 50% en 60% -->
		<acceptable>
		    <lower>5.90</lower>
		    <upper>17.70</upper>
		</acceptable>
		<critical>		
		    <lower>4.72</lower>
		    <upper>18.80</upper>
		</critical>
	    </EntranceDose>
	    <kVp>
		<acceptable>
		    <lower>28</lower>
		    <upper>28</upper>
		</acceptable>
		<critical>		
		    <lower>28</lower>
		    <upper>28</upper>
		</critical>
	    </kVp>
	</limits>
    </action>


    <action>
	<!-- FlatField -->
	<name>WAD_MG_flatField</name>
	<!-- series selectie -->
	<!-- SOP class ForPresentation -->
	<match type="DICOM" field="MediaStorageSOPClassUID">1.2.840.10008.5.1.4.1.1.1.2.1</match>
	<!-- AEC mode Manual -->
	<match type="DICOM" field="ExposureControlMode">MANUAL</match>
	<!-- Molybdenum filter -->
	<match type="DICOM" field="FilterMaterial">MOLYBDENUM</match>
	<!-- parameters -->
	<params>
	    <!-- number of rows to skip in FlatField -->
	    <!-- use "auto" to find the first non-constant pixel -->
	    <skipRows>auto</skipRows>
	    <!-- relative threshold for deviating pixels in FlatField -->
	    <threshold>0.2</threshold>
	    <!-- relative threshold for deviating ROIs in FlatField -->
	    <SNRthreshold>0.2</SNRthreshold>
	</params>
	<limits>
	    <mean>
		<!-- 580 +/- 10% en 15% -->
		<acceptable>
		    <lower>522</lower>
		    <upper>638</upper>
		</acceptable>
		<critical>		
		    <lower>493</lower>
		    <upper>667</upper>
		</critical>
	    </mean>
	    <SNR_ROI>
		<!-- 54.1 +/- 10% en 15% -->
		<acceptable>
		    <lower>48.69</lower>
		    <upper>59.51</upper>
		</acceptable>
		<critical>		
		    <lower>45.98</lower>
		    <upper>62.21</upper>
		</critical>
	    </SNR_ROI>
	</limits>
    </action>


<!-- ACTION LIMITS TEMPLATE
	<limits>
	    <param_name>
		<acceptable>
		    <lower></lower>
		    <upper></upper>
		</acceptable>
		<critical>		
		    <lower></lower>
		    <upper></upper>
		</critical>
	    </param_name>
	</limits>
-->

</WAD_MG_config>
