<?xml version="1.0" encoding="UTF-8"?>

<!--
    Configuratie voor WAD MR analyse module
-->

<WAD_MR_config>
    <!-- naam van de configuratie -->
    <name>Avanto</name>

    <!-- beschrijving -->
    <description>WAD MR configuratie voor Siemens Avanto</description>

    <!-- versie / datum -->
    <version>20130910</version>
    
    <!-- Logfile verbose options -->
    <logverbose>
	<!-- mode: 0 = quiet, 1 = to logfile, 2 = to screen, 3 = to log + screen -->
	<mode>1</mode>
	<!-- level: 1 = normal, 2 = output series search -->
	<level>1</level>
    </logverbose>

<!--
    Lijst van analyses
    De configuratie is per Matlab functie:
    - <name> naam van de Matlab functie (zie documentatie voor valide funties)
    - <match> series description: indien gelijk wordt de functie gestart
      <match field="SeriesDescription"> idem
      <match type="DCM4CHEE" field="SeriesDescription"> idem
      <match field="ImagesInSeries"> aantal beelden in de DICOM serie: indien gelijk wordt de functie gestart
      <match type="DICOM" field="SequenceName"> DICOM veld inhoud: indien gelijk wordt de functie gestart
      Valide "DCM4CHEE" velden (uit de DCM4CHEE database) zijn SeriesDescription en ImagesInSeries (aantal beelden in serie).
      NB: test op DICOM veld is trager dan "interne" velden.
    - optioneel: <autoComment> kopieer een tekst of float DICOM veld naar resultaten, bijv StudyComment
    - optioneel: <params> configuratie parameters per funtie
    - optioneel: <limits> actielimieten per resultaat
-->

    <action>
	<!-- Transmitter amplitude and frequency -->
	<name>WAD_MR_TxAmplFreq</name>
	<!-- series selectie -->
	<match>ACR TRA T1 DIS2D</match>
	<!-- auto comment field -->
	<autoComment>
	    <description>QC Study Comment</description>
	    <field>AdditionalPatientHistory</field>
	    <level>1</level>
	</autoComment>
	<autoComment>
	    <description>Scanner Software Version</description>
	    <field>SoftwareVersion</field>
	    <level>2</level>
	</autoComment>
	<!-- parameters -->
	<params>
	    <!-- scanner-specifieke DICOM info -->
	    <TxAmpl>
		<field>Private_0029_1020</field>
		<type>char</type>
		<pattern>flReferenceAmplitude = </pattern>
	    </TxAmpl>
	    <TxFreq>
		<field>ImagingFrequency</field>
	    </TxFreq>
	</params>
	<limits>
	    <TxAmpl>
		<acceptable>
		    <lower>107.00</lower>
		    <upper>145.00</upper>
		</acceptable>
		<critical>		
		    <lower>88.00</lower>
		    <upper>164.00</upper>
		</critical>
	    </TxAmpl>
	    <TxFreq>
	    <!-- Transmitter frequency should be a running average, not fixed values!
		 The magnet will slowly ramp down ~500Hz/year or so -->
		<acceptable>
		    <lower>127.7620</lower>
		    <upper>127.7630</upper>
		</acceptable>
		<critical>		
		    <lower>127.7640</lower>
		    <upper>127.7610</upper>
		</critical>
	    </TxFreq>
	</limits>
    </action>
    
    <action>
	<!-- Geometry Z-axis: lenght of ACR phantom -->
	<name>WAD_MR_geomZ</name>
	<!-- series selectie -->
	<match>ACR SAG DIS2D</match>
	<limits>
	    <lengthZ_mm>
		<acceptable>
		    <lower>146.50</lower>
		    <upper>148.50</upper>
		</acceptable>
		<critical>		
		    <lower>146.00</lower>
		    <upper>149.00</upper>
		</critical>
	    </lengthZ_mm>
	    <!-- no action limits for rotationSAG_deg -->
	</limits>
    </action>

    <action>
	<!-- Geometry X and Y-axis: diameter of ACR phantom -->
	<name>WAD_MR_geomXY</name>
	<!-- series selectie -->
	<match>ACR TRA T1 DIS2D</match>
	<!-- parameters -->
	<params>
	    <!-- image nummer voor geometrie -->
	    <!-- toegestaan: <nummmer>, firstInSeries, lastInSeries -->
	    <image>7</image>
	    <!-- optie: interpolatie in beeld domein met factor 2-tot-de-macht <interpolPower> -->
	    <!-- default waarde is 1 -->
	    <!-- <interpolPower>1</interpolPower> -->
	    <!-- optie: exclusie van luchtbel in fit van ellips, gedefinieerd als hoek in graden -->
	    <!-- default waarde is 17 -->	    
	    <!-- <excludeAngle_deg>17</excludeAngle_deg> -->
	    <!-- optie: exclusie van pixels op afstand van de gefitte ellips, bij 2e en 3e iteratie -->
	    <!-- default waardes zijn resp 20 en 10 -->
	    <!-- <excludedst2_pix>20</excludedst2_pix> -->
	    <!-- <excludedst3_pix>10</excludedst3_pix> -->
	</params>
	<limits>
	    <diameterX_mm>
		<acceptable>
		    <lower>189.00</lower>
		    <upper>191.00</upper>
		</acceptable>
		<critical>		
		    <lower>188.50</lower>
		    <upper>191.50</upper>
		</critical>
	    </diameterX_mm>
	    <diameterY_mm>
		<acceptable>
		    <lower>189.00</lower>
		    <upper>191.00</upper>
		</acceptable>
		<critical>		
		    <lower>188.50</lower>
		    <upper>191.50</upper>
		</critical>
	    </diameterY_mm>
	</limits>
    </action>

    <action>
	<!-- SNR, ghosting en signaal (B1) homogeniteit -->
	<name>WAD_MR_SNR</name>
	<!-- series selectie -->
	<match>ACR SNR 4CH</match>
	<match field="ImagesInSeries">1</match>
	<!-- parameters -->
	<params>
	    <!-- welk beeld te gebruiken? -->
	    <!-- toegestaan: <nummmer>, firstInSeries, lastInSeries -->
	    <!-- Siemens bewaart combined image in een nieuwe serie -->
	    <image>1</image>
	    <!-- achtergrond ROI positie (vanuit centrum fantoom) voor SNR en ghosting -->
	    <!-- let op: dit is voor beeld ZONDER 2D GradWarp! -->
	    <!-- default waarde is 108, waarde in [mm]  -->
	    <backgroundROIshift>112</backgroundROIshift>
	    <!-- achtergrond ROI grootte voor SNR en ghosting -->
	    <!-- default waarde is 7, waarde in [mm]  -->
	    <backgroundROIsize>7</backgroundROIsize>
	    <!-- Fantoom ROI grootte voor SNR, ghosting en uniformiteit -->
	    <!-- default waarde is 75, waarde in [mm] -->
	    <ROIradius>75</ROIradius>
	    <!-- overige opties: zie WAD_MR_geomXY deze kunnen hier ook gebruikt worden -->
	</params>
	<limits>
	    <SNR>
		<acceptable>
		    <lower>553.00</lower>
		    <upper>675.00</upper>
		</acceptable>
		<critical>		
		    <lower>491.00</lower>
		    <upper>737.00</upper>
		</critical>
	    </SNR>
	    <ghostRow_percent>
		<acceptable>
		    <lower>0</lower>
		    <upper>0.5</upper>
		</acceptable>
		<critical>		
		    <lower>0</lower>
		    <upper>1.0</upper>
		</critical>
	    </ghostRow_percent>
	    <ghostCol_percent>
		<acceptable>
		    <lower>0</lower>
		    <upper>0.5</upper>
		</acceptable>
		<critical>		
		    <lower>0</lower>
		    <upper>1.0</upper>
		</critical>
	    </ghostCol_percent>
	    <imageUniformity_percent>
		<acceptable>
		    <lower>81.60</lower>
		    <upper>86.60</upper>
		</acceptable>
		<critical>		
		    <lower>79.10</lower>
		    <upper>89.20</upper>
		</critical>
	    </imageUniformity_percent>
	</limits>
    </action>

    <action>
	<!-- SNR of separate channels of a multi-channel coil -->
	<name>WAD_MR_SNR_MultiChannel</name>
	<!-- series selectie -->
	<match>ACR SNR 4CH</match>
	<match field="ImagesInSeries">4</match>
	<!-- parameters -->
	<params>
	    <!-- toegestaan: <nummmer>, firstInSeries, lastInSeries, inNextSeries -->
	    <!-- Siemens bewaart combined image in een nieuwe serie -->
	    <combinedImage>inNextSeries</combinedImage>
	    <!-- achtergrond ROI positie (vanuit centrum fantoom) voor SNR en ghosting -->
	    <!-- let op: dit is voor beeld ZONDER 2D GradWarp! -->
	    <!-- default waarde is 108, waarde in [mm]  -->
	    <backgroundROIshift>112</backgroundROIshift>
	    <!-- achtergrond ROI grootte voor SNR en ghosting -->
	    <!-- default waarde is 7, waarde in [mm]  -->
	    <backgroundROIsize>7</backgroundROIsize>
	    <!-- Fantoom ROI grootte voor SNR, ghosting en uniformiteit -->
	    <!-- default waarde is 75, waarde in [mm] -->
	    <ROIradius>75</ROIradius>
	    <!-- overige opties: zie WAD_MR_geomXY deze kunnen hier ook gebruikt worden -->
	</params>
    </action>

    <action>
	<!-- shim / B0 map -->
	<name>WAD_MR_B0_uniformity</name>
	<!-- series selectie -->
	<!-- 1e serie heeft 2 magnitude beelden, 2e serie 1 fase beeld. Analyse op 1e serie -->
	<match>ACR B0 FIELD</match>
	<!-- parameters -->
	<params>
	    <!-- Vendor-specific import function for phase images. The actual Matlab function
	    naming gets a prefix "WAD_MR_B0_read". -->
	    <type>SiemensServiceStimEcho</type>
	</params>
	<limits>
	    <B0_uniformity_ppm>
		<acceptable>
		    <lower>0.0</lower>
		    <upper>1.5</upper>
		</acceptable>
		<critical>		
		    <lower>0.0</lower>
		    <upper>2.0</upper>
		</critical>
	    </B0_uniformity_ppm>
	</limits>
    </action>

</WAD_MR_config>
