<?xml version="1.0" encoding="UTF-8"?>

<!--
    Configuratie voor WAD MR analyse module
-->

<WAD_MR_config>
    <!-- naam van de configuratie -->
    <name>Avanto</name>

    <!-- beschrijving -->
    <description>WAD MR configuratie voor VUmc Siemens Avanto</description>

    <!-- versie / datum -->
    <version>20121105</version>
    
    <!-- DICOM veld (Matlab benaming!) waarvan inhoud naar rapportage gekopieerd wordt,
         en op de MRI bij patient registratie kan worden ingevuld, bijvoorbeeld "na onderhoud" -->
    <autoCommentField>StudyComments</autoCommentField>
    
    <!-- Logfile verbose options -->
    <logverbose>
	<!-- mode: 0 = quiet, 1 = to logfile, 2 = to screen, 3 = to log + screen -->
	<mode>1</mode>
	<!-- level: 1 = normal, 2 = output series search -->
	<level>1</level>
    </logverbose>

<!--
    Lijst van analyses
    De configuratie is per Matlab functie:
    - <name> naam van de Matlab functie (zie documentatie voor valide funties)
    - <match> series description: indien gelijk wordt de functie gestart
      <match field="SeriesDescription"> idem
      <match type="DCM4CHEE" field="SeriesDescription"> idem
      <match field="ImagesInSeries"> aantal beelden in de DICOM serie: indien gelijk wordt de functie gestart
      <match type="DICOM" field="SequenceName"> DICOM veld inhoud: indien gelijk wordt de functie gestart
      Valide "DCM4CHEE" velden (uit de DCM4CHEE database) zijn SeriesDescription en ImagesInSeries (aantal beelden in serie).
      NB: test op DICOM veld is trager dan "interne" velden.
    - optioneel: <params> configuratie parameters per funtie
    - optioneel: <limits> actielimieten per resultaat
-->

    <action>
	<!-- Transmitter amplitude and frequency -->
	<name>WAD_MR_TxAmplFreq</name>
	<!-- series selectie -->
	<match>ACR TRA T1 DIS2D</match>
	<!-- parameters -->
	<params>
	    <!-- scanner-specifieke DICOM info -->
	    <TxAmpl>
		<field>Private_0029_1020</field>
		<type>char</type>
		<pattern>flReferenceAmplitude = </pattern>
	    </TxAmpl>
	    <TxFreq>
		<field>ImagingFrequency</field>
	    </TxFreq>
	</params>
    </action>
    
    <action>
	<!-- Geometry Z-axis: lenght of ACR phantom -->
	<name>WAD_MR_geomZ</name>
	<!-- series selectie -->
	<match>ACR SAG DIS2D</match>
	<!-- parameters -->
	<params></params>
    </action>

    <action>
	<!-- Geometry X and Y-axis: diameter of ACR phantom -->
	<name>WAD_MR_geomXY</name>
	<!-- series selectie -->
	<match>ACR TRA T1 DIS2D</match>
	<!-- parameters -->
	<params>
	    <!-- image nummer voor geometrie -->
	    <!-- toegestaan: <nummmer>, firstInSeries, lastInSeries -->
	    <image>7</image>
	</params>
    </action>

    <action>
	<!-- SNR, ghosting en signaal (B1) homogeniteit -->
	<name>WAD_MR_SNR</name>
	<!-- series selectie -->
	<match>ACR SNR 4CH</match>
	<match field="ImagesInSeries">1</match>
	<!-- parameters -->
	<params>
	    <!-- welk beeld te gebruiken? -->
	    <!-- toegestaan: <nummmer>, firstInSeries, lastInSeries -->
	    <!-- Siemens bewaart combined image in een nieuwe serie -->
	    <image>1</image>
	    <!-- achtergrond ROI positie (vanuit centrum fantoom) voor SNR en ghosting -->
	    <!-- let op: dit is voor beeld zonder 2D distortion correction! -->
	    <ROIshift>112</ROIshift>
	</params>
    </action>

    <action>
	<!-- SNR of separate channels of a multi-channel coil -->
	<name>WAD_MR_SNR_MultiChannel</name>
	<!-- series selectie -->
	<match>ACR SNR 4CH</match>
	<match field="ImagesInSeries">4</match>
	<!-- parameters -->
	<params>
	    <!-- toegestaan: <nummmer>, firstInSeries, lastInSeries, inNextSeries -->
	    <!-- Siemens bewaart combined image in een nieuwe serie -->
	    <combinedImage>inNextSeries</combinedImage>
	    <!-- achtergrond ROI positie (vanuit centrum fantoom) voor SNR en ghosting -->
	    <!-- let op: dit is voor beeld zonder 2D distortion correction! -->
	    <ROIshift>112</ROIshift>
	</params>
    </action>

    <action>
	<!-- shim / B0 map -->
	<name>WAD_MR_B0_uniformity</name>
	<!-- series selectie -->
	<!-- 1e serie heeft 2 magnitude beelden, 2e serie 1 fase beeld. Analyse op 1e serie -->
	<match>ACR B0 FIELD</match>
	<!-- parameters -->
	<params>
	    <!-- Vendor-specific import function for phase images. The actual Matlab function
	    naming gets a prefix "WAD_MR_B0_read". -->
	    <type>SiemensServiceStimEcho</type>
	</params>
    </action>

</WAD_MR_config>
